var reasonShowLength=20,STEP_NUM=1;function findData(e){$("#queryFrom").val(e),"undefined"!=typeof resutTable?resutTable.ajax.reload():($(".myTableSection").show(),resutTable=$("#resutTable").DataTable({autoWidth:!0,paging:!0,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:dataTableHeight,scrollCollapse:!0,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},createdRow:function(e,t,a){null!=t.deliveryReason&&t.deliveryReason.length>reasonShowLength&&($(e).children("td").eq(7).attr("onclick","javascript:showFullScript($(this));"),$(e).children("td").eq(7).addClass("cursor_zoom_in")),$(e).children("td").eq(7).attr("content",t.deliveryReason)},ajax:{url:_ctx+"/delivery/getDeliveryRecordData.json",type:"POST",data:function(e){return"WEB"==$("#queryFrom").val()?(e.queryGroup=$("#queryGroup").val(),e.queryDevice=$("#queryDevice").val(),e.queryDateBegin=$("#queryExcuteDateBegin").val(),e.queryDateEnd=$("#queryExcuteDateEnd").val()):"MOBILE"==$("#queryFrom").val()&&(e.queryGroup=$("#queryGroup_mobile").val(),e.queryDevice=$("#queryDevice_mobile").val(),e.queryDateBegin=$("#queryExcuteDateBegin_mobile").val(),e.queryDateEnd=$("#queryExcuteDateEnd_mobile").val()),e},error:function(e,t,a){ajaxErrorHandler()}},order:[[1,"desc"]],pageLength:100,drawCallback:function(e){$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),bindTrEvent(),initCheckedItems(),unfoldMobileMenu()},columns:[{},{data:"deliveryBeginTime"},{data:"createBy"},{data:"groupName"},{data:"deviceName"},{data:"systemVersion",className:"center"},{data:"scriptName"},{},{}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,t,a,r){return r.row+r.settings._iDisplayStart+1}},{targets:[7],className:"left",searchable:!0,orderable:!1,render:function(e,t,a){return null!=a.deliveryReason&&a.deliveryReason.length>reasonShowLength?getPartialContentHtml(a.deliveryReason,reasonShowLength):a.deliveryReason}},{targets:[8],className:"center",searchable:!0,orderable:!0,render:function(e,t,a){var r="";switch(a.deliveryResult){case"SUCCESS":r='<button name="btn_viewLog" class="btn btn-secondary" onclick="viewProvisionLog(this)" data-step-id="'+a.logStepId+'">成功</button>';break;case"NO_DIFFERENT":r='<button name="btn_viewLog" class="btn btn-success" onclick="viewProvisionLog(this)" data-step-id="'+a.logStepId+'">無差異</a>';break;case"ERROR":r='<button name="btn_viewLog" class="btn btn-danger" onclick="viewProvisionLog(this)" data-step-id="'+a.logStepId+'">失敗</a>'}return r}}]}))}function viewProvisionLog(e){var t=$(e).data("step-id"),a=$(e).closest("tr").find("td").eq(1).text(),r=$(e).closest("tr").find("td").eq(2).text(),o=$(e).closest("tr").find("td").eq(3).text(),n=$(e).closest("tr").find("td").eq(4).text(),s=$(e).closest("tr").find("td").eq(5).text(),l=$(e).closest("tr").find("td").eq(6).text(),i=$(e).closest("tr").find("td").eq(7).text(),d=$(e).text();$.ajax({url:_ctx+"/delivery/viewProvisionLog.json",data:{logStepId:t},type:"POST",dataType:"json",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(e){if("200"==e.code){e.data.log;var t=null!=e.data.log?e.data.log.replace(/(\r\n|\r|\n)/g,"<br>"):"異常無紀錄";$("#viewModal_beginTime").text(a),$("#viewModal_userName").text(r),$("#viewModal_groupName").text(o),$("#viewModal_deviceName").text(n),$("#viewModal_systemVersion").text(s),$("#viewModal_scriptName").text(l),$("#viewModal_reason").text(i),$("#viewModal_result").text(d),$("#viewModal_provisionLog").html(t),$("#viewProvisionLogModal").modal("show")}else alert(e.message)},error:function(e,t,a){ajaxErrorHandler()}})}$(document).ready(function(){initMenuStatus("toggleMenu_cm","toggleMenu_cm_items","cm_record"),$("#viewProvisionLogModal").on("shown.bs.modal",function(){currentDiffPos=-1,setTimeout(function(){$("#viewModal_provisionLog").scrollTop(0)},300)})});