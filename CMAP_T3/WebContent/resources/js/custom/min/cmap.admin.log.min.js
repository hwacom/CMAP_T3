var resultTable_errorLog,resultTable_jobLog,isModify=!1,remarkShowLength=50;function viewDetail(e){$.ajax({url:_ctx+"/admin/log/getDetailInfo.json",data:{logType:e.split("@~")[0],logId:e.split("@~")[1]},type:"POST",dataType:"json",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(a){"200"==a.code?($("#detailsModal").modal(),$("#viewDetailTitle").html(e.split("@~")[0]+"明細"),$("#viewDetail").html(a.data.details)):alert(a.message)},error:function(e,a,r){ajaxErrorHandler()}})}function findErrorLogData(e){$("#queryFrom").val(e),"MOBILE"==e&&$("#collapseExample").collapse("hide"),$("#divErrorLog").show(),$("#divJobLog").hide(),void 0!==resultTable_errorLog?resultTable_errorLog.ajax.reload():resultTable_errorLog=$("#resultTable_errorLog").DataTable({autoWidth:!0,paging:!0,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full_numbers",processing:!0,scrollX:!0,scrollY:dataTableHeight,scrollCollapse:!0,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},createdRow:function(e,a,r){null!=a.message&&a.message.length>remarkShowLength&&($(e).children("td").eq(4).attr("onclick","javascript:changeShowContent(this, "+remarkShowLength+");"),$(e).children("td").eq(4).addClass("cursor_zoom_in")),$(e).children("td").eq(4).attr("content",a.message)},ajax:{url:_ctx+"/admin/log/getErrorLog.json",type:"POST",data:function(e){},beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},error:function(e,a,r){ajaxErrorHandler()}},order:[[1,"desc"]],pageLength:100,initComplete:function(e,a){},drawCallback:function(e){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust(),$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),feather.replace(),bindTrEvent()},columns:[{},{data:"entryDateStr",class:"center"},{data:"logger"},{data:"logLevel",class:"center"},{},{}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,a,r,t){return t.row+t.settings._iDisplayStart+1}},{targets:[4],className:"left",searchable:!0,orderable:!0,render:function(e,a,r,t){return null!=r.message&&r.message.length>remarkShowLength?getPartialContentHtml(r.message,remarkShowLength):r.message}},{targets:[5],className:"center",searchable:!1,orderable:!1,render:function(e,a,r){return'<a href="#" onclick="viewDetail(\'ERROR@~'+r.logId+'\')"><span data-feather="zoom-in"></span></a>'}}]})}function findJobLogData(e){$("#queryFrom").val(e),"MOBILE"==e&&$("#collapseExample").collapse("hide"),$("#divErrorLog").hide(),$("#divJobLog").show(),void 0!==resultTable_jobLog?resultTable_jobLog.ajax.reload():resultTable_jobLog=$("#resultTable_jobLog").DataTable({autoWidth:!0,paging:!0,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full_numbers",processing:!0,scrollX:!0,scrollY:dataTableHeight,scrollCollapse:!0,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},ajax:{url:_ctx+"/admin/log/getJobLog.json",type:"POST",data:function(e){},beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},error:function(e,a,r){ajaxErrorHandler()}},order:[[1,"desc"]],pageLength:100,initComplete:function(e,a){},drawCallback:function(e){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust(),$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),bindTrEvent()},columns:[{},{data:"startTimeStr"},{data:"jobGroup"},{},{},{data:"recordsNum"},{data:"remark"},{data:"endTimeStr"},{data:"spendTimeInSeconds"},{data:"cronExpression"},{data:"prevFireTimeStr"},{data:"nextFireTimeStr"},{data:"logId"}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,a,r,t){return t.row+t.settings._iDisplayStart+1}},{targets:[3],className:"left",searchable:!0,orderable:!0,render:function(e,a,r){return'<a href="#" onclick="viewDetail(\'JOB@~'+r.logId+"')\">"+r.jobName+"</a>"}},{targets:[4],className:"left",searchable:!0,orderable:!0,render:function(e,a,r){return"FAILED"===r.result?'<font color="red">'+r.result+"</font>":"SUCCESS"===r.result?'<font color="green">'+r.result+"</font>":'<font color="purple">'+r.result+"</font>"}}]})}$(document).ready(function(){initMenuStatus("toggleMenu_admin","toggleMenu_admin_items","bk_log"),$("#btnSearchErrorLog_web").click(function(e){findErrorLogData("WEB")}),$("#btnSearchJobLog_web").click(function(e){findJobLogData("WEB")}),$("#btnSearchErrorLog_mobile").click(function(e){findErrorLogData("MOBILE")}),$("#btnSearchJobLog_mobile").click(function(e){findJobLogData("MOBILE")})});