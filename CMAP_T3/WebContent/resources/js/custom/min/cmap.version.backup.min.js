var remarkShowLength=80;function doBackup(){var e=$("input[name=chkbox]:checked"),a=$("#queryConfigType").val(),r=new Array,t=new Object;t.configType=a,r.push(t);for(var n=0;n<e.length;n++)(t=new Object).deviceListId=e[n].value,r.push(t);$.ajax({url:_ctx+"/version/backup/execute",data:JSON.stringify(r),headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",dataType:"json",async:!0,beforeSend:function(e){showProcessing()},complete:function(){hideProcessing()},success:function(e){"200"==e.code?(alert(e.message),findData($("#queryFrom").val()),setTimeout(function(){$("#backupDialogModal").modal("hide")},500)):alert(e.message)},error:function(e,a,r){ajaxErrorHandler()}})}function chkChecked(){var e=!1;return $("input[type=checkbox][name=chkbox]").each(function(){if(this.checked)return e=!0,!1}),e}function findData(e){$("#queryFrom").val(e),$("input[name=checkAll]").prop("checked",!1),"MOBILE"==e&&$("#collapseExample").collapse("hide"),"undefined"!=typeof resultTable?resultTable.ajax.reload():($(".myTableSection").show(),resultTable=$("#resultTable").DataTable({autoWidth:!0,paging:!0,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:dataTableHeight,scrollCollapse:!0,pageLength:10,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},createdRow:function(e,a,r){null!=a.deviceName&&a.deviceName.length>remarkShowLength&&($(e).children("td").eq(3).attr("onclick","javascript:changeShowContent(this, "+remarkShowLength+");"),$(e).children("td").eq(3).addClass("cursor_zoom_in")),$(e).children("td").eq(3).attr("content",a.deviceName)},ajax:{url:_ctx+"/version/getDeviceListData.json",type:"POST",data:function(e){return"WEB"==$("#queryFrom").val()?(e.queryGroup=$("#queryGroup").val(),e.queryDevice=$("#queryDevice").val()):"MOBILE"==$("#queryFrom").val()&&(e.queryGroup=$("#queryGroup_mobile").val(),e.queryDevice=$("#queryDevice_mobile").val()),e},error:function(e,a,r){ajaxErrorHandler()}},drawCallback:function(e){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust(),$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),initCheckedItems(),bindTrEvent()},columns:[{},{},{data:"groupName"},{},{data:"systemVersion",className:"center"},{},{data:"configType"},{}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,a,r){return'<input type="checkbox" id="chkbox" name="chkbox" onclick="changeTrBgColor(this)" value='+r.deviceListId+">"}},{targets:[1],className:"center",searchable:!1,orderable:!1,render:function(e,a,r,t){return t.row+t.settings._iDisplayStart+1}},{targets:[3],className:"left",searchable:!0,orderable:!0,render:function(e,a,r,t){return null!=r.deviceName&&r.deviceName.length>remarkShowLength?getPartialContentHtml(r.deviceName,remarkShowLength):r.deviceName}},{targets:[5],className:"left",searchable:!0,orderable:!0,render:function(e,a,r){var t="";return null!=r.versionId&&(t='<a href="#" onclick="viewConfig(\''+r.versionId+"')\">"+r.configVersion+"</a>"),t}},{targets:[7],className:"center",searchable:!1,orderable:!0,render:function(e,a,r){return r.backupTimeStr}}]}))}$(document).ready(function(){initMenuStatus("toggleMenu_cm","toggleMenu_cm_items","cm_backup"),changeDeviceMenu("queryDevice",$("#queryGroup").val()),$("#btnBackup").click(function(e){chkChecked()?$("#backupDialogModal").modal({backdrop:"static"}):alert("請勾選要備份的設備")}),$("#btnConfirm").click(function(e){doBackup()}),findData("WEB")});