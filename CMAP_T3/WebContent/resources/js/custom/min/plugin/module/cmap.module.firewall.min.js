var timer,startTime,timer_start,timer_end;function countDown(a){if("START"==a)startTime=parseInt(_timeout)-1,timer_start=performance.now(),timer=setInterval(function(){$("#timeoutMsg").val("Timeout倒數 : "+startTime+" 秒"),startTime--},1e3);else{timer_end=performance.now();var e=(parseInt(timer_end)-parseInt(timer_start))/1e3;$("#timeoutMsg").val("查詢花費時間 : "+e+" 秒"),clearInterval(timer)}}function findData(a){$("#queryFrom").val(a),0!=$("#queryDateBegin").val().trim().length?0!=$("#queryTimeBegin").val().trim().length&&0!=$("#queryTimeEnd").val().trim().length?("MOBILE"==a&&$("#collapseExample").collapse("hide"),"undefined"!=typeof resultTable?(resultTable.ajax.reload(),$(".myTableSection").show()):($(".myTableSection").show(),resultTable=$("#resultTable").DataTable({autoWidth:!0,paging:!0,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:dataTableHeight,scrollCollapse:!0,pageLength:100,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},createdRow:function(a,e,t){},ajax:{url:_ctx+"/plugin/module/firewall/log/getFirewallLogData.json",type:"POST",data:function(a){return"WEB"==$("#queryFrom").val()?(a.queryType=$("#queryType").val(),a.queryDevName=$("#queryDevName").val(),a.querySrcIp=$("#querySrcIp").val(),a.querySrcPort=$("#querySrcPort").val(),a.queryDstIp=$("#queryDstIp").val(),a.queryDstPort=$("#queryDstPort").val(),a.queryDateBegin=$("#queryDateBegin").val(),a.queryDateEnd=$("#queryDateEnd").val(),a.queryTimeBegin=$("#queryTimeBegin").val(),a.queryTimeEnd=$("#queryTimeEnd").val()):"MOBILE"==$("#queryFrom").val()&&(a.queryType=$("#queryTypeMobile").val(),a.queryDevName=$("#queryDevNameMobile").val(),a.querySrcIp=$("#query_SrcIp_mobile").val(),a.querySrcPort=$("#query_SrcPort_mobile").val(),a.queryDstIp=$("#query_DstIp_mobile").val(),a.queryDstPort=$("#query_DstPort_mobile").val(),a.queryDateBegin=$("#queryDateBegin_mobile").val(),a.queryDateEnd=$("#queryDateEnd_mobile").val(),a.queryTimeBegin=$("#queryTimeBegin").val(),a.queryTimeEnd=$("#queryTimeEnd").val()),a},beforeSend:function(){countDown("START")},complete:function(){countDown("STOP")},error:function(a,e,t){ajaxErrorHandler()},dataSrc:function(a){return a.data.length>0?null!=a.otherMsg&&""!=a.otherMsg&&$("#div_TotalFlow").css("display","contents"):($("#div_TotalFlow").css("display","contents"),$("#result_TotalFlow").text("查無符合資料")),a.data},timeout:1e3*parseInt(_timeout)},order:[[3,"desc"]],initComplete:function(a,e){null!=e.msg&&($(".myTableSection").hide(),alert(e.msg))},drawCallback:function(a){$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),$("[data-field]").removeClass("td-na");var e=$("#queryType").val();"APP"==e?($('[data-field="severity"]').eq(0).addClass("td-na"),$('[data-field="srcCountry"]').eq(0).addClass("td-na"),$('[data-field="service"]').eq(0).addClass("td-na"),$('[data-field="url"]').eq(0).addClass("td-na"),$('[data-field="sentByte"]').eq(0).addClass("td-na"),$('[data-field="rcvdByte"]').eq(0).addClass("td-na"),$('[data-field="utmAction"]').eq(0).addClass("td-na"),$('[data-field="level"]').eq(0).addClass("td-na"),$('[data-field="user"]').eq(0).addClass("td-na"),$('[data-field="message"]').eq(0).addClass("td-na"),$('[data-field="attack"]').eq(0).addClass("td-na")):"FORWARDING"==e?($('[data-field="severity"]').eq(0).addClass("td-na"),$('[data-field="srcCountry"]').eq(0).addClass("td-na"),$('[data-field="service"]').eq(0).addClass("td-na"),$('[data-field="url"]').eq(0).addClass("td-na"),$('[data-field="level"]').eq(0).addClass("td-na"),$('[data-field="user"]').eq(0).addClass("td-na"),$('[data-field="message"]').eq(0).addClass("td-na"),$('[data-field="attack"]').eq(0).addClass("td-na")):"SYSTEM"==e?($('[data-field="severity"]').eq(0).addClass("td-na"),$('[data-field="srcIp"]').eq(0).addClass("td-na"),$('[data-field="srcPort"]').eq(0).addClass("td-na"),$('[data-field="srcCountry"]').eq(0).addClass("td-na"),$('[data-field="dstIp"]').eq(0).addClass("td-na"),$('[data-field="dstPort"]').eq(0).addClass("td-na"),$('[data-field="proto"]').eq(0).addClass("td-na"),$('[data-field="service"]').eq(0).addClass("td-na"),$('[data-field="url"]').eq(0).addClass("td-na"),$('[data-field="app"]').eq(0).addClass("td-na"),$('[data-field="action"]').eq(0).addClass("td-na"),$('[data-field="sentByte"]').eq(0).addClass("td-na"),$('[data-field="rcvdByte"]').eq(0).addClass("td-na"),$('[data-field="utmAction"]').eq(0).addClass("td-na"),$('[data-field="attack"]').eq(0).addClass("td-na")):"INTRUSION"==e?($('[data-field="service"]').eq(0).addClass("td-na"),$('[data-field="url"]').eq(0).addClass("td-na"),$('[data-field="app"]').eq(0).addClass("td-na"),$('[data-field="sentByte"]').eq(0).addClass("td-na"),$('[data-field="rcvdByte"]').eq(0).addClass("td-na"),$('[data-field="utmAction"]').eq(0).addClass("td-na"),$('[data-field="level"]').eq(0).addClass("td-na"),$('[data-field="user"]').eq(0).addClass("td-na"),$('[data-field="message"]').eq(0).addClass("td-na")):"WEBFILTER"==e&&($('[data-field="severity"]').eq(0).addClass("td-na"),$('[data-field="srcCountry"]').eq(0).addClass("td-na"),$('[data-field="app"]').eq(0).addClass("td-na"),$('[data-field="utmAction"]').eq(0).addClass("td-na"),$('[data-field="level"]').eq(0).addClass("td-na"),$('[data-field="user"]').eq(0).addClass("td-na"),$('[data-field="message"]').eq(0).addClass("td-na"),$('[data-field="attack"]').eq(0).addClass("td-na")),$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust(),bindTrEvent()},rowCallback:function(a,e){$("td:eq(4)",a).attr("data-field","severity"),$("td:eq(5)",a).attr("data-field","srcIp"),$("td:eq(6)",a).attr("data-field","srcPort"),$("td:eq(7)",a).attr("data-field","srcCountry"),$("td:eq(8)",a).attr("data-field","dstIp"),$("td:eq(9)",a).attr("data-field","dstPort"),$("td:eq(10)",a).attr("data-field","proto"),$("td:eq(11)",a).attr("data-field","service"),$("td:eq(12)",a).attr("data-field","url"),$("td:eq(13)",a).attr("data-field","app"),$("td:eq(14)",a).attr("data-field","action"),$("td:eq(15)",a).attr("data-field","sentByte"),$("td:eq(16)",a).attr("data-field","rcvdByte"),$("td:eq(17)",a).attr("data-field","utmAction"),$("td:eq(18)",a).attr("data-field","level"),$("td:eq(19)",a).attr("data-field","user"),$("td:eq(20)",a).attr("data-field","message"),$("td:eq(21)",a).attr("data-field","attack")},columns:[{},{data:"type"},{data:"devName"},{data:"dateStr"},{data:"timeStr"},{data:"severity"},{data:"srcIp"},{data:"srcPort"},{data:"srcCountry"},{data:"dstIp"},{data:"dstPort"},{data:"proto"},{data:"service"},{data:"url"},{data:"app"},{data:"action"},{data:"sentByte",className:"right"},{data:"rcvdByte",className:"right"},{data:"utmAction"},{data:"level"},{data:"user"},{data:"message"},{data:"attack"}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(a,e,t,d){return d.row+d.settings._iDisplayStart+1}}]}))):alert(msg_chooseTime):alert(msg_chooseDate)}$(document).ready(function(){initMenuStatus("toggleMenu_plugin","toggleMenu_plugin_items","cm_firewallLog"),$("input").val("");new Cleave(".input-port",{numericOnly:!0,blocks:[5]});$("#resultTable").on("xhr.dt",function(a,e,t,d){null!=t.msg&&($(".myTableSection").hide(),alert(t.msg))});var a=new Date,e=a.getFullYear(),t=parseInt(a.getMonth())+1;t=t<10?"0".concat(t):t;var d=a.getDate(),l=e+"-"+t+"-"+(d=d<10?"0".concat(d):d);$("#queryDateBegin").val(l),$("#queryDateEnd").val(l),$("#queryTimeBegin").val("00:00"),$("#queryTimeEnd").val("23:59"),$("#queryType").change(function(){"SYSTEM"==$(this).val()?$("[data-ipPortSec]").hide():$("[data-ipPortSec]").show()})});