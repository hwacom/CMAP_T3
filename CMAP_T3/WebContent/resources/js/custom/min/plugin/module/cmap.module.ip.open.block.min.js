var resultTable_blockedIpRecord,blockedIpTableHeight,blockReasonShowLength=30,openReasonShowLength=30,_navAndMenuAndFooterHeight=0,_deductHeight=0;function checkboxOnChangeEvent(){$("input[name=chkbox]").change(function(e){$("input[name=chkbox]:checked").length>0?$("#btnIpOpen").attr("disabled",!1):$("#btnIpOpen").attr("disabled",!0)})}function calBlockedIpSectionHeight(){_navAndMenuAndFooterHeight=0,_deductHeight=0,_navAndMenuAndFooterHeight="none"!=$(".mobile-menu").css("display")&&null!=$(".mobile-menu").css("display")?$(".navbar").outerHeight()+$(".footer").outerHeight()+$(".mobile-menu").outerHeight():$(".navbar").outerHeight()+$(".footer").outerHeight(),"none"!=$(".search-bar-large").css("display")&&null!=$(".search-bar-large").css("display")?(_navAndMenuAndFooterHeight+=$(".search-bar-large").outerHeight(),_deductHeight=110):_deductHeight=210,"none"!=$(".mainTable").css("display")&&null!=$(".mainTable").css("display")&&(_deductHeight+=$(".mainTable").outerHeight()),"none"!=$("#divBlockedTitle").css("display")&&null!=$("#divBlockedTitle").css("display")&&(_deductHeight+=$("#divBlockedTitle").outerHeight()),blockedIpTableHeight=(blockedIpTableHeight=Math.round(window.innerHeight-_navAndMenuAndFooterHeight-_deductHeight))<165?165:blockedIpTableHeight}function doConfirmIpOpenByBtn(){confirm("按下確認後將立即執行IP開通作業，請再次確認是否執行?")&&doIpOpenByBtn()}function doIpOpenByBtn(){for(var e=new Array,a=$("input[name=chkbox]:checked"),t=0;t<a.length;t++)e.push(a[t].value);$.ajax({url:_ctx+"/delivery/doIpOpenByBtn.json",data:{listId:e},type:"POST",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(e){"200"==e.code?(alert(e.message),setTimeout(function(){$("#stepModal").modal("hide")},500)):alert(e.message)},error:function(e,a,t){ajaxErrorHandler()}})}function findBlockedIpRecordData(){calBlockedIpSectionHeight(),void 0!==resultTable_blockedIpRecord?resultTable_blockedIpRecord.ajax.reload():($("#divBlockedIpRecord").show(),resultTable_blockedIpRecord=$("#resultTable_blockedIpRecord").DataTable({autoWidth:!0,paging:!0,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:blockedIpTableHeight,scrollCollapse:!0,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},createdRow:function(e,a,t){null!=a.blockReason&&a.blockReason.length>blockReasonShowLength&&($(e).children("td").eq(5).attr("onclick","javascript:showFullScript($(this));"),$(e).children("td").eq(5).addClass("cursor_zoom_in")),$(e).children("td").eq(5).attr("content",a.blockReason)},ajax:{url:_ctx+"/delivery/getBlockedIpData.json",type:"POST",data:function(e){return"WEB"==$("#queryFrom").val()?e.queryGroupId=$("#queryGroup").val():"MOBILE"==$("#queryFrom").val()&&(e.queryGroupId=$("#queryGroup_mobile").val()),e},error:function(e,a,t){ajaxErrorHandler()}},order:[[3,"desc"]],pageLength:100,drawCallback:function(e){$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),bindTrEventOnlyCheckbox(),checkboxOnChangeEvent();var a=window.location.pathname;"/ipOpenBlock"===a.substring(a.lastIndexOf("/"),a.length)&&($('[data-field="status"]').hide(),$('[data-field="openTime"]').hide(),$('[data-field="openReason"]').hide(),$('[data-field="openBy"]').hide()),$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust()},rowCallback:function(e,a){$("td:eq(1)",e).attr("data-field","seq"),$("td:eq(2)",e).attr("data-field","groupName"),$("td:eq(3)",e).attr("data-field","ipAddress"),$("td:eq(4)",e).attr("data-field","status"),$("td:eq(5)",e).attr("data-field","blockTime"),$("td:eq(6)",e).attr("data-field","blockReason"),$("td:eq(7)",e).attr("data-field","blockBy"),$("td:eq(8)",e).attr("data-field","openTime"),$("td:eq(9)",e).attr("data-field","openReason"),$("td:eq(10)",e).attr("data-field","openBy")},columns:[{},{},{data:"groupName",className:"left"},{data:"ipAddress",className:"left"},{data:"statusFlag",className:"center"},{data:"blockTimeStr",className:"center"},{},{data:"blockBy",className:"center"},{data:"openTimeStr",className:"center"},{},{data:"openBy",className:"center"}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,a,t){return'<input type="checkbox" id="chkbox" name="chkbox" onclick="changeTrBgColor(this)" value='+t.listId+">"}},{targets:[1],className:"center",searchable:!1,orderable:!1,render:function(e,a,t,n){return n.row+n.settings._iDisplayStart+1}},{targets:[6],className:"left",searchable:!0,orderable:!1,render:function(e,a,t){return null!=t.blockReason&&t.blockReason.length>blockReasonShowLength?getPartialContentHtml(t.blockReason,blockReasonShowLength):t.blockReason}},{targets:[9],className:"left",searchable:!0,orderable:!1,render:function(e,a,t){return null!=t.openReason&&t.openReason.length>openReasonShowLength?getPartialContentHtml(t.openReason,openReasonShowLength):t.openReason}}]}))}$(document).ready(function(){$("#btnIpOpen").click(function(e){doConfirmIpOpenByBtn()})});