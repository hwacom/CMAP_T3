var currentDiffPos=-1,diffPos=[],diffPos_offsetTopDeductNum=66,remarkShowLength=50;function changeCompareDesc(e){e?$("#compareModal_summary").html("共 "+diffPos.length+" 個差異；第 "+(currentDiffPos+1)+" 個差異點"):$("#compareModal_summary").html("共 "+diffPos.length+" 個差異")}function compareFile(){var e=$("input[name=chkbox]:checked");if(e.length>2)alert("版本比對僅能勾選兩筆檔案進行，請重新選擇");else{for(var o,a=new Array,r=0;r<e.length;r++)(o=new Object).name="versionId",o.value=e[r].value,a.push(o);$.ajax({url:_ctx+"/version/compare",data:JSON.stringify(a),headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",dataType:"json",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(e){"200"==e.code?($("#compareModal_contentLineNum").html(e.data.versionLineNum),$("#compareModal_contentLeft").html(e.data.contentLeft),$("#compareModal_contentRight").html(e.data.contentRight),$("#viewModal_versionLeft").val(e.data.versionLeft),$("#viewModal_versionRight").val(e.data.versionRight),currentDiffPos=0,""!=e.data.diffPos?(diffPos=e.data.diffPos.split(","),$("#compareModal_summary").html("共 "+diffPos.length+" 個差異")):$("#compareModal_summary").html("無差異"),$("#compareModal").modal("show")):alert(e.message)},error:function(e,o,a){ajaxErrorHandler()}})}}function deleteData(){0!=$("input[name=chkbox]:checked").length?confirm("確認刪除?","deleteDataGO"):alert("請選擇要刪除的項目")}function deleteDataGO(){for(var e,o=$("input[name=chkbox]:checked"),a=new Array,r=0;r<o.length;r++)(e=new Object).name="versionId",e.value=o[r].value,a.push(e);$.ajax({url:_ctx+"/version/delete",data:JSON.stringify(a),headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",dataType:"json",async:!0,success:function(e){"200"==e.code&&(clearDialog(),alert(e.message),findData($("#queryFrom").val()))},error:function(e,o,a){ajaxErrorHandler()}})}function findData(e){$("#queryFrom").val(e),$("input[name=checkAll]").prop("checked",!1),"MOBILE"==e&&$("#collapseExample").collapse("hide"),"undefined"!=typeof resutTable?resutTable.ajax.reload():($(".myTableSection").show(),resutTable=$("#resutTable").DataTable({autoWidth:!0,paging:!0,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:dataTableHeight,scrollCollapse:!0,pageLength:100,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},createdRow:function(e,o,a){null!=o.deviceName&&o.deviceName.length>remarkShowLength&&($(e).children("td").eq(3).attr("onclick","javascript:changeShowContent(this, "+remarkShowLength+");"),$(e).children("td").eq(3).addClass("cursor_zoom_in")),$(e).children("td").eq(3).attr("content",o.deviceName)},ajax:{url:_ctx+"/version/getVersionInfoData.json",type:"POST",data:function(e){return"WEB"==$("#queryFrom").val()?(e.queryGroup1=$("#queryGroup1").val(),e.queryGroup2=$("#queryGroup2").val(),e.queryDevice1=$("#queryDevice1").val(),e.queryDevice2=$("#queryDevice2").val(),e.queryDateBegin1=$("#queryExcuteDateBegin1").val(),e.queryDateEnd1=$("#queryExcuteDateEnd1").val(),e.queryDateBegin2=$("#queryExcuteDateBegin2").val(),e.queryDateEnd2=$("#queryExcuteDateEnd2").val(),e.queryConfigType=$("#queryConfigType").val(),e.queryNewChkbox=!!$("#queryNewChkbox").prop("checked")):"MOBILE"==$("#queryFrom").val()&&(e.queryGroup1=$("#queryGroup1_mobile").val(),e.queryGroup2=$("#queryGroup2_mobile").val(),e.queryDevice1=$("#queryDevice1_mobile").val(),e.queryDevice2=$("#queryDevice2_mobile").val(),e.queryDateBegin1=$("#queryExcuteDateBegin1_mobile").val(),e.queryDateEnd1=$("#queryExcuteDateEnd1_mobile").val(),e.queryDateBegin2=$("#queryExcuteDateBegin2_mobile").val(),e.queryDateEnd2=$("#queryExcuteDateEnd2_mobile").val(),e.queryConfigType=$("#queryConfigType_mobile").val(),e.queryNewChkbox=!!$("#queryNewChkbox_mobile").prop("checked")),e},error:function(e,o,a){ajaxErrorHandler()}},initComplete:function(e,o){},drawCallback:function(e){$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),bindTrEvent(),initCheckedItems()},columns:[{},{},{data:"groupName"},{},{data:"systemVersion",className:"center"},{data:"configType"},{},{}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,o,a){return'<input type="checkbox" id="chkbox" name="chkbox" onclick="changeTrBgColor(this)" value='+a.versionId+">"}},{targets:[1],className:"center",searchable:!1,orderable:!1,render:function(e,o,a,r){return r.row+r.settings._iDisplayStart+1}},{targets:[3],className:"left",searchable:!0,orderable:!0,render:function(e,o,a,r){return null!=a.deviceName&&a.deviceName.length>remarkShowLength?getPartialContentHtml(a.deviceName,remarkShowLength):a.deviceName}},{targets:[6],className:"left",searchable:!0,orderable:!0,render:function(e,o,a){return'<a href="#" onclick="viewConfig(\''+a.versionId+"')\">"+a.configVersion+"</a>"}},{targets:[7],className:"center",searchable:!1,orderable:!0,render:function(e,o,a){return a.backupTimeStr}}]}))}$(document).ready(function(){initMenuStatus("toggleMenu_cm","toggleMenu_cm_items","cm_manage"),changeDeviceMenu("queryDevice1",$("#queryGroup1").val()),changeDeviceMenu("queryDevice2",$("#queryGroup2").val()),$("#btnCompare").click(function(e){compareFile()}),$("#btnDelete").click(function(e){deleteData()});var e=$("div[id$='compareModal_contentLeft']").add($("div[id$='compareModal_contentRight']")).add($("div[id$='compareModal_contentLineNum']"));e.on("scroll",function(){e.scrollTop($(this).scrollTop())}),$("#compareModal_contentLineNum").scroll(function(){var e=$("#compareModal_contentLineNum").scrollTop(),o=$("#compareModal_contentLineNum").prop("offsetHeight"),a=$("#compareModal_contentLineNum").prop("scrollHeight");0==e?currentDiffPos=-1:e+o==a&&(currentDiffPos=diffPos.length)}),$("#compareModal").on("shown.bs.modal",function(){currentDiffPos=-1,setTimeout(function(){$("#compareModal_contentLineNum").scrollTop(0)},300)}),$("#jumpToTop").click(function(e){$(".diffPos").css("background-color",""),$("#compareModal_contentLineNum").animate({scrollTop:0},"500"),currentDiffPos=-1,$(".diffPos").removeClass("compare-current-pos"),changeCompareDesc(!1)}),$("#jumpToPre").click(function(e){currentDiffPos<=0?currentDiffPos=diffPos.length-1:currentDiffPos-=1,console.log("diffPos["+currentDiffPos+"] : "+$(".diffPos")[currentDiffPos].offsetTop),$("#compareModal_contentLineNum").animate({scrollTop:$(".diffPos")[currentDiffPos].offsetTop-diffPos_offsetTopDeductNum},"500"),$(".diffPos").removeClass("compare-current-pos"),$(".diffPos").eq(currentDiffPos).addClass("compare-current-pos"),changeCompareDesc(!0)}),$("#jumpToNext").click(function(e){currentDiffPos+1>=diffPos.length?currentDiffPos=0:currentDiffPos+=1,console.log("diffPos["+currentDiffPos+"] : "+$(".diffPos")[currentDiffPos].offsetTop),$("#compareModal_contentLineNum").animate({scrollTop:$(".diffPos")[currentDiffPos].offsetTop-diffPos_offsetTopDeductNum},"500"),$(".diffPos").removeClass("compare-current-pos"),$(".diffPos").eq(currentDiffPos).addClass("compare-current-pos"),changeCompareDesc(!0)}),$("#jumpToBottom").click(function(e){$(".diffPos").css("background-color","");var o=$("#compareModal_contentLineNum").prop("offsetHeight"),a=$("#compareModal_contentLineNum").prop("scrollHeight");$("#compareModal_contentLineNum").animate({scrollTop:a-o},"500"),$(".diffPos").removeClass("compare-current-pos"),changeCompareDesc(!1)})});