var remarkShowLength=20;function initActionBar(){$("#modifyActionBar").hide(),$("#defaultActionBar").show(),$(".dataTable").find("thead").eq(0).find("tr > th").css("pointer-events","auto"),$("select[name=resutTable_length]").removeAttr("disabled"),$("input[type=search]").removeAttr("disabled")}function toggleActionBar(){$("#modifyActionBar").toggle(),$("#defaultActionBar").toggle()}function changeModifyView(){var e=$("input[name=chkbox]:checked");if(0!=e.length){for(var t=0;t<e.length;t++){document.getElementsByTagName("body")[0].innerText;$("input[name=chkbox]:checked:eq("+t+")").attr("disabled","disabled"),$("input[name=chkbox]:checked:eq("+t+")").parents("tr").children().eq(2).removeAttr("onclick"),$("input[name=chkbox]:checked:eq("+t+")").parents("tr").children().eq(2).html(function(){return'<input type="text" name="modifySettingRemark" value="'+$(this).attr("content")+'" class="form-control form-control-sm" style="min-width: 200px" />'}),$("input[name=chkbox]:checked:eq("+t+")").parents("tr").children().eq(3).html(function(){return'<input type="text" name="modifySettingName" value="'+$(this).text()+'" class="form-control form-control-sm" style="min-width: 200px" readonly/>'}),$("input[name=chkbox]:checked:eq("+t+")").parents("tr").children().eq(5).html(function(){return'<input type="text" name="modifySettingValue" value="'+$(this).text()+'" class="form-control form-control-sm" style="min-width: 200px" />'})}toggleActionBar(),$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust(),$(".dataTable").find("thead").eq(0).find("tr > th").removeClass("sorting sorting_asc sorting_desc"),$(".dataTable").find("thead").eq(0).find("tr > th").css("pointer-events","none"),$("select[name=resutTable_length]").attr("disabled","disabled"),$("input[type=search]").attr("disabled","disabled"),$("li[id^=resutTable_]").addClass("disabled")}else alert("請先勾選欲修改的項目")}function envAction(e){var t=new Object,a=$("input[name='chkbox']:checked").map(function(){return $(this).val()}).get();if(t.settingIds=a,"save"==e){var n=$("input[name='modifySettingName']").map(function(){return $(this).val()}).get(),i=$("input[name='modifySettingValue']").map(function(){return $(this).val()}).get(),r=$("input[name='modifySettingRemark']").map(function(){return $(this).val()}).get();t.modifySettingName=n,t.modifySettingValue=i,t.modifySettingRemark=r}else if("delete"==e){if(0==$("input[name=chkbox]:checked").length)return void alert("請先勾選欲刪除的項目")}$.ajax({url:_ctx+"/admin/env/"+e,data:JSON.stringify(t),headers:{Accept:"application/json","Content-Type":"application/json"},type:"POST",dataType:"json",async:!0,beforeSend:function(){showProcessing()},complete:function(){hideProcessing()},success:function(e){"200"==e.code?(alert(e.message),findData($("#queryFrom").val())):(alert("envAction > success > else :: resp.code: "+e.code),alert(e.message))},error:function(e,t,a){ajaxErrorHandler()}})}function findData(e){$("#queryFrom").val(e),$("input[name=checkAll]").prop("checked",!1),"MOBILE"==e&&$("#collapseExample").collapse("hide"),initActionBar(),"undefined"!=typeof resultTable?resultTable.ajax.reload():($(".myTableSection").show(),resultTable=$("#resultTable").DataTable({autoWidth:!0,paging:!1,bFilter:!0,ordering:!0,info:!0,serverSide:!0,bLengthChange:!0,pagingType:"full",processing:!0,scrollX:!0,scrollY:dataTableHeight,scrollCollapse:!0,language:{url:_ctx+"/resources/js/dataTable/i18n/Chinese-traditional.json"},createdRow:function(e,t,a){null!=t.settingRemark&&t.settingRemark.length>remarkShowLength&&($(e).children("td").eq(2).attr("onclick","javascript:changeShowContent(this, "+remarkShowLength+");"),$(e).children("td").eq(2).addClass("cursor_zoom_in")),$(e).children("td").eq(2).attr("content",t.settingRemark)},ajax:{url:_ctx+"/admin/env/getEnvConfig.json",type:"POST",data:function(e){},dataSrc:function(e){return $("#diffMsg").text(e.msg),e.data},error:function(e,t,a){ajaxErrorHandler()}},order:[[3,"asc"]],initComplete:function(e,t){},drawCallback:function(e){$.fn.dataTable.tables({visible:!0,api:!0}).columns.adjust(),$("div.dataTables_length").parent().removeClass("col-sm-12"),$("div.dataTables_length").parent().addClass("col-sm-6"),$("div.dataTables_filter").parent().removeClass("col-sm-12"),$("div.dataTables_filter").parent().addClass("col-sm-6"),$("div.dataTables_info").parent().removeClass("col-sm-12"),$("div.dataTables_info").parent().addClass("col-sm-6"),$("div.dataTables_paginate").parent().removeClass("col-sm-12"),$("div.dataTables_paginate").parent().addClass("col-sm-6"),bindTrEvent()},columns:[{},{},{},{data:"settingName"},{},{data:"settingValue"},{data:"_settingValue"},{data:"createTimeStr"},{data:"createBy"},{data:"updateTimeStr"},{data:"updateBy"}],columnDefs:[{targets:[0],className:"center",searchable:!1,orderable:!1,render:function(e,t,a){return'<input type="checkbox" id="chkbox" name="chkbox" onclick="changeTrBgColor(this)" value="'+a.settingId+'">'}},{targets:[1],className:"center",searchable:!1,orderable:!1,render:function(e,t,a,n){return n.row+n.settings._iDisplayStart+1}},{targets:[2],className:"left",searchable:!0,orderable:!0,render:function(e,t,a,n){return null!=a.settingRemark&&a.settingRemark.length>remarkShowLength?getPartialContentHtml(a.settingRemark,remarkShowLength):a.settingRemark}},{targets:[4],className:"center",searchable:!0,orderable:!0,render:function(e,t,a,n){var i=a.same;return a.same||(i='<font color="red">'+a.same+"</font>"),i}}]}))}$(document).ready(function(){initMenuStatus("toggleMenu_admin","toggleMenu_admin_items","bk_env"),$("#btnRefreshAll").click(function(){envAction("refreshAll")}),$("#btnModify").click(function(){changeModifyView()}),$("#btnDelete").click(function(){envAction("delete")}),$("#btnModifySubmit").click(function(){envAction("save")}),$("#btnModifyCancel").click(function(){findData($("#queryFrom").val())})});